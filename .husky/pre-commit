echo "ğŸ” Running pre-commit checks..."

# Check if there are any staged TypeScript files (excluding legacy dirs)
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' | grep -v 'new-structure\|old-structure' | head -20)

if [ -n "$STAGED_TS_FILES" ]; then
    echo "ğŸ“ Type checking staged files..."
    npm run typecheck
    if [ $? -ne 0 ]; then
        echo "âŒ TypeScript errors found - commit blocked"
        echo "ğŸ’¡ Fix the errors above and try again"
        exit 1
    fi
    echo "âœ… Type check passed"
else
    echo "â„¹ï¸  No TypeScript files to check (excluding legacy directories)"
fi

# Run linting but only show warnings, don't block commit
if grep -q '"lint"' package.json; then
    echo "ğŸ” Running linter (warnings only)..."
    npm run lint || echo "âš ï¸  Linting warnings found (not blocking commit)"
fi

echo "âœ… Pre-commit checks passed!"
