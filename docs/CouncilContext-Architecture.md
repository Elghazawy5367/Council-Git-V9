# CouncilContext Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CouncilContext                            â”‚
â”‚                     (State Management)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ InputState  â”‚  â”‚ExecutionStateâ”‚  â”‚ JudgeState â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ â€¢ text      â”‚  â”‚ â€¢ phase      â”‚  â”‚ â€¢ mode     â”‚           â”‚
â”‚  â”‚ â€¢ files     â”‚  â”‚ â€¢ isRunning  â”‚  â”‚ â€¢ isRunningâ”‚           â”‚
â”‚  â”‚ â€¢ source    â”‚  â”‚ â€¢ responses  â”‚  â”‚ â€¢ result   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ progress   â”‚  â”‚ â€¢ error    â”‚           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            LLMSelectionState                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ selectedLLMs: ['gpt4', 'claude', 'gemini']           â”‚  â”‚
â”‚  â”‚ â€¢ availableLLMs: [GPT-4, Claude, Gemini, DeepSeek]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ uses
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenRouterService                            â”‚
â”‚                  (API Communication)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  executeParallel(prompt, files, selectedLLMs)                  â”‚
â”‚  â”œâ”€ Promise.all([...LLM calls...])                             â”‚
â”‚  â”œâ”€ Error isolation per LLM                                    â”‚
â”‚  â”œâ”€ Progress tracking                                          â”‚
â”‚  â””â”€ Returns: LLMResponse[]                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ calls
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 OpenRouter API (https://openrouter.ai)          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  GPT-4  â”‚  â”‚ Claude  â”‚  â”‚ Gemini  â”‚  â”‚ DeepSeek â”‚        â”‚
â”‚  â”‚  Turbo  â”‚  â”‚   3.5   â”‚  â”‚  Pro    â”‚  â”‚          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚      ğŸ¤–           ğŸ§            âœ¨            ğŸ”®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Two-Phase Workflow

```
Phase 1: Parallel Execution
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Input (text + files)
        â”‚
        â–¼
    executeParallel()
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
        â–¼      â–¼      â–¼      â–¼      â–¼
     GPT-4  Claude Gemini DeepSeek Local
        â”‚      â”‚      â”‚      â”‚      â”‚
        â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              LLMResponse[] (stored in execution.llmResponses)


Phase 2: Judge Synthesis
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    execution.llmResponses
        â”‚
        â–¼
    Select Judge Mode
        â”‚
        â”œâ”€ Ruthless Judge (critical filtering)
        â”œâ”€ Consensus Judge (find common ground)
        â”œâ”€ Debate Judge (highlight conflicts)
        â””â”€ Pipeline Judge (sequential build)
        â”‚
        â–¼
    executeJudge()
        â”‚
        â–¼
    Unified Synthesis Result (stored in judge.result)
```

## Component Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      App.tsx                       â”‚
â”‚                                                    â”‚
â”‚  <CouncilProvider>                                 â”‚
â”‚    â”‚                                               â”‚
â”‚    â”œâ”€ <YourComponent1 />                          â”‚
â”‚    â”‚    â”‚                                          â”‚
â”‚    â”‚    â””â”€ useCouncilContext()                    â”‚
â”‚    â”‚       â”œâ”€ setInputText()                      â”‚
â”‚    â”‚       â”œâ”€ executeParallel()                   â”‚
â”‚    â”‚       â””â”€ executeJudge()                      â”‚
â”‚    â”‚                                               â”‚
â”‚    â”œâ”€ <YourComponent2 />                          â”‚
â”‚    â”‚    â”‚                                          â”‚
â”‚    â”‚    â””â”€ useCouncilContext()                    â”‚
â”‚    â”‚       â”œâ”€ toggleLLM()                         â”‚
â”‚    â”‚       â””â”€ setJudgeMode()                      â”‚
â”‚    â”‚                                               â”‚
â”‚    â””â”€ <YourComponent3 />                          â”‚
â”‚         â”‚                                          â”‚
â”‚         â””â”€ useCouncilContext()                    â”‚
â”‚            â”œâ”€ execution.llmResponses              â”‚
â”‚            â””â”€ judge.result                        â”‚
â”‚  </CouncilProvider>                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Flow

```
1. User enters text/uploads files
   â””â”€> input.text, input.files

2. User selects LLMs
   â””â”€> llmSelection.selectedLLMs

3. User clicks "Run Parallel"
   â””â”€> executeParallel()
       â”œâ”€> execution.phase = 'parallel'
       â”œâ”€> execution.isRunning = true
       â”œâ”€> OpenRouterService.executeParallel()
       â”‚   â”œâ”€> Progress updates: execution.progress
       â”‚   â””â”€> Responses: execution.llmResponses
       â””â”€> execution.phase = 'idle'

4. User selects judge mode
   â””â”€> judge.mode

5. User clicks "Run Judge"
   â””â”€> executeJudge()
       â”œâ”€> execution.phase = 'judge'
       â”œâ”€> judge.isRunning = true
       â”œâ”€> OpenRouterService.executeParallel() (for judge)
       â”‚   â””â”€> Judge result: judge.result
       â””â”€> execution.phase = 'idle'
```

## API Actions

```
Input Actions
â”œâ”€ setInputText(text: string)
â”œâ”€ setInputFiles(files: File[])
â”œâ”€ setInputSource(source)
â””â”€ clearInput()

LLM Selection Actions
â”œâ”€ toggleLLM(llmId: string)
â”œâ”€ selectAllLLMs()
â””â”€ deselectAllLLMs()

Execution Actions
â”œâ”€ executeParallel(): Promise<void>
â”œâ”€ cancelExecution()
â””â”€ clearResponses()

Judge Actions
â”œâ”€ setJudgeMode(mode)
â”œâ”€ executeJudge(): Promise<void>
â””â”€ clearJudgeResult()

API Key Actions
â””â”€ setApiKey(key: string)
```

## Error Handling

```
try {
  await executeParallel()
  â”œâ”€ LLM1: âœ“ Success
  â”œâ”€ LLM2: âœ“ Success
  â”œâ”€ LLM3: âœ— Error (isolated, others continue)
  â””â”€ LLM4: âœ“ Success
  
  await executeJudge()
  â””â”€ Synthesis result or error in judge.error
  
} catch (error) {
  // Handle top-level errors
  console.error(error)
}
```

## Integration with Existing Stores

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application State                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Zustand Stores â”‚        â”‚ CouncilContext   â”‚    â”‚
â”‚  â”‚ (Global State) â”‚        â”‚ (Component State)â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ â€¢ council.storeâ”‚        â”‚ â€¢ InputState     â”‚    â”‚
â”‚  â”‚ â€¢ settings     â”‚        â”‚ â€¢ ExecutionState â”‚    â”‚
â”‚  â”‚ â€¢ dashboard    â”‚        â”‚ â€¢ JudgeState     â”‚    â”‚
â”‚  â”‚ â€¢ analytics    â”‚        â”‚ â€¢ LLMSelection   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                           â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                     â”‚                               â”‚
â”‚              Both can coexist                       â”‚
â”‚              and complement each other              â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
